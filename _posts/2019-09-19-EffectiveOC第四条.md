---
layout:     post
title:      多用类型常量少用,#define预处理指令
subtitle:   Effective OC 第四条
date:       2019-09-19
author:     二狗子
header-img: img/home-bg-o.jpg
catalog: true
tags:
    - Effective OC
---

# 多用类型常量少用,#define预处理指令
### 宏定义

```
#define ANIMATION_DURATION 0.3
```

以上为一个动画持续时间的宏定义，使用方法就是在需要0.3的地方直接写`ANIMATION_DURATION`。预处理指令会将`ANIMATION_DURATION `替换为0.3。

先说为什么要这么做，这里我想起了最近同事聊天时提到的一个事，大学的时候我们学C的时候通常看到这样的变量命名`a1，b1，c1`。同事最近独自在搞一个项目，他的代码基本就是自己看，所以他的变量名很随意，另一个同事更是调侃说：“甚至可以直接从a1到a1000，都用不到b”。事实也是如此，如果代码只有自己看，这样做无可厚非，但是我们还是想在一定程度上分享我们的代码或者说我们还没有能力独自维护一个项目从生到死，早晚会有人插一脚的。所以我们的代码需要被别人看懂，如果代码里全部都是“魔法数”，就很难理解代码的意思，后期维护更是麻烦了。所以宏定义在某种程度上缓解了这个问题。

既然我们使用了宏定义，那么我们就尽量让宏定义能让人看懂，不能敷衍了事。显然`define`的方式是不太容易被人看懂的。**首先**全是大写就不是正常人类能流畅阅读的，**其次**所有引入这个头文件的代码，其中的`ANIMATION_DURATION `后会被替换成`0.3`。基于这两点，我们需要更换一种方式。

### static const

先看一下这两个单词有什么作用，这个显然是使用了C语言的语法。

* static

两个作用：作用域和储存方式。即当前文件全局和静态

* const

一个作用：只读

如果不写static，如果另一个编译单元声明了同名变量，就会抛出重复报错。

如果不写const，就是可以被修改的。

如果写了static const 编译器不会创建符号，而是会像`define`一样，把所有遇到的变量都替换成常量。

```
static const NSTimeInterval kAnimationDuration = 0.3
```

以上同样表示了动画时间间隔，我们可以加入**常量类型**，并且采用了能流畅阅读的**驼峰命名**。如果常量局限于某“编译单元”，则在前面加字母**k**，如果常量类外可见，则通常以类名为前缀。

### 位置

一般来说定义常量最好不要定义在头文件中，一般将常量定义在.m文件中。

### 特殊情况

有时一些常量是需要公开的。比如广播名，app内的广播名一般是全局使用的，所以可以使用一个全局可见的常值变量。

一般的解决办法是创建一个“全局符号表”，在.h文件中对外声明常量，在.m文件中定义常量。

```
.h
extern NSString *const EOCStringConstant;

.m
NSString *const EOCStringConstant = @"value";
```

这样对外暴露的只有`EOCStringConstant`，使用的人可以不知道具体代表什么意义。

其实看到这里的时候，应该有问题提出来了，起码我就有两个问题

* extern 是啥意思？
* 为啥*在const前面，有啥规则吗？

#### extern 
 
 他的作用总结一句话就是，被extern修饰的变量可以在其他编译单元访问。这类“变量”必须要名义，且只能定义一次。同时由于是外部可见的，所以就难免会遇到命名冲突的问题，因此我们最好在“变量”名前面加上所属类名，避免重复。
 具体可以看[这里](https://blog.csdn.net/Think88666/article/details/90706719)。
 
#### const 与 *
 
 需要先明确一点，OC的对象基本都是以指针的形式在日常使用的，而指针中存储的其实是一个地址。
 
 `*`在const前面也就表示了这是一个const指针，也就是说指针中存储的地址是只读的，不可以被改变的。
 
 `*`在const后面表示指针指向的值是不能修改的。
 
 所以正常来说我们是不是应该这么写
 
``` const NSString *const someString = @"aaa"```

但是一般我们不会写前面的const，为什么？其实NSString的定义就是不可变字符串，他在一定程度上就代替了前面const（至于是不是真的同等意思，这里不敢下结论。）
 


